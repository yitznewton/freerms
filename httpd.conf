<VirtualHost *:80>
  ServerName freerms.example.org

  DocumentRoot /path/to/freerms/web
  Alias /sf /path/to/symfony/data/web/sf

  <Location /database>
    # secure login

    RewriteEngine on
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
  </Location>

  <Files admin.php>
    # secure admin area

    RewriteEngine on
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
  </Files>

  <Files admin_dev.php>
    # secure admin area

    RewriteEngine on
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
  </Files>

  <Directory /path/to/freerms/web>
    AllowOverride None
    Order allow,deny
    Allow from all

    RewriteEngine on

    # we check if the .html version is here (caching)
    RewriteRule ^$ index.html [QSA]
    RewriteRule ^([^.]+)$ $1.html [QSA]
    RewriteCond %{REQUEST_FILENAME} !-f

    # no, so we redirect to our front web controller
    RewriteRule ^(.*)$ index.php [QSA,L]
  </Directory>

  <Directory /path/to/symfony/data/web/sf>
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>
</VirtualHost>

<VirtualHost *:443>
  ServerName freerms.example.org
  SSLEngine on

  DocumentRoot /path/to/freerms/web
  Alias /sf /path/to/symfony/data/web/sf

  <Location /refer>
    # referer header often stripped in HTTPS traffic,
    # so redirect to HTTP

    RewriteEngine on
    RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} [R,L]
  </Location>

  <Directory /path/to/freerms/web>
    AllowOverride None
    Order allow,deny
    Allow from all

    RewriteEngine on

    # we check if the .html version is here (caching)
    RewriteRule ^$ index.html [QSA]
    RewriteRule ^([^.]+)$ $1.html [QSA]
    RewriteCond %{REQUEST_FILENAME} !-f

    # no, so we redirect to our front web controller
    RewriteRule ^(.*)$ index.php [QSA,L]
  </Directory>

  <Directory /path/to/symfony/data/web/sf>
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>
</VirtualHost>
